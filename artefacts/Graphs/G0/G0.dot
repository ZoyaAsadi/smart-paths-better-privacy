digraph G0 {
  graph [rankdir=LR, fontsize=10, labelloc=top,
         label="Open Library — Consent Graph (G0)"];
  node  [shape=box, fontsize=10];
  edge  [fontsize=9];

  // =======================
  // UI: Consent states/actions
  // =======================
  subgraph cluster_ui {
    label="UI (Klaro banner + modal)"; style=dashed; color=gray50;

    Entry          [label="Entry (first visit)"];
    BannerToast    [label="Banner (toast)"];
    Modal          [label="Privacy settings (modal)"];
    Manage         [label="ManageCookies entry"];

    // First-layer actions
    Decline        [label="I decline"];
    AcceptSelected [label="Accept selected"];
    AcceptAll      [label="Accept all"];
    LetMeChoose    [label="Let me choose → modal"];

    // Modal: toggles (ON actions)
    ToggleAll      [label="Master switch ON/OFF"];
    AccSecurity    [label="Accept Security"];
    AccAnalytics   [label="Accept Analytics"];
    AccExtMedia    [label="Accept External media"];
    AccSupport     [label="Accept Support/Chat"];
    AccPayments    [label="Accept Payments"];
    AccPersonal    [label="Accept Personalization"];
    Save           [label="Save (apply selected)"];

    ConsentSaved   [label="Consent saved", shape=ellipse, color=gray40];
  }

  // =======================
  // Pages
  // =======================
  subgraph cluster_pages {
    label="Pages (OpenCms — Open Library)"; style=rounded; color=gray50;

    Home          [label="Home / Open Library"];
    Discover      [label="Discover the Best"];
    SearchBooks   [label="Search Books (PHP)"];
    Audiobooks    [label="Audiobooks (PHP)"];
    DigitalMag    [label="Digital Magazine"];
    Membership    [label="Membership"];
    ContactUs     [label="Contact Us (PHP)"];
    Login         [label="Login"];
  }

  // =======================
  // Services (non-essential; gated)
  // =======================
  subgraph cluster_services {
    label="Services (non-essential; gated)"; style=rounded; color=gray50;

    Essentials     [label="Essential (always required)", penwidth=2];
    SecuritySvc    [label="Security  (+2)", penwidth=2];
    AnalyticsSvc   [label="Analytics (+2)", penwidth=2];
    ExtMediaSvc    [label="External media (+3)", penwidth=2];
    SupportSvc     [label="Support/Chat (+2)", penwidth=2];
    PaymentsSvc    [label="Payments (+2)", penwidth=2];
    PersonalSvc    [label="Personalization (+1)", penwidth=2];
  }

  // =======================
  // Outcomes — Capabilities (Group 1)
  // =======================
  subgraph cluster_outcomes_a {
    label="Outcomes — Capabilities"; style=rounded; color="#2b8a3e";
    Out_BasicAccess   [label="Basic access (essentials only)"];
    Out_AllContent    [label="All content unlocked"];
    Out_AllMedia      [label="All embedded media playable"];
    Out_Payments      [label="Payments enabled"];
    Out_Personalized  [label="Personalized recommendations"];
    Out_SecuredLogin  [label="Bot-protected login/contact"];
  }

  // Outcomes — Telemetry (Group 2)
  OutcomeTelemetry [label="Telemetry/Analytics running", color="#2b8a3e", shape=ellipse];

  // =======================
  // UI flow (first layer)
  // =======================
  Entry       -> BannerToast   [label="show_banner"];
  BannerToast -> Decline       [label="click(decline)"];
  BannerToast -> AcceptSelected[label="click(accept_selected)"];
  BannerToast -> AcceptAll     [label="click(accept_all)"];
  BannerToast -> LetMeChoose   [label="click(let_me_choose)"];
  LetMeChoose -> Modal         [label="open modal"];

  // Modal interactions
  Modal     -> ToggleAll     [label="toggle all (on/off)"];
  Modal     -> AccSecurity   [label="toggle ON"];
  Modal     -> AccAnalytics  [label="toggle ON"];
  Modal     -> AccExtMedia   [label="toggle ON"];
  Modal     -> AccSupport    [label="toggle ON"];
  Modal     -> AccPayments   [label="toggle ON"];
  Modal     -> AccPersonal   [label="toggle ON"];
  Modal     -> Save          [label="click(save)"];

  // Manage-cookies entry from any page
  Home       -> Manage [label="click(manage)"];
  Discover   -> Manage [label="click(manage)"];
  SearchBooks-> Manage [label="click(manage)"];
  Audiobooks -> Manage [label="click(manage)"];
  DigitalMag -> Manage [label="click(manage)"];
  Membership -> Manage [label="click(manage)"];
  ContactUs  -> Manage [label="click(manage)"];
  Login      -> Manage [label="click(manage)"];
  Manage     -> Modal  [label="to(modal)"];

  // =======================
  // Site navigation (sample)
  // =======================
  Home  -> Discover    [label="to(page)"];
  Home  -> SearchBooks [label="to(page)"];
  Home  -> Audiobooks  [label="to(page)"];
  Home  -> DigitalMag  [label="to(page)"];
  Home  -> Membership  [label="to(page)"];
  Home  -> ContactUs   [label="to(page)"];
  Home  -> Login       [label="to(page)"];

  // =======================
  // Page → Service dependencies (requires)
  // =======================
  Home        -> AnalyticsSvc  [label="requires(analytics)"];
  Discover    -> AnalyticsSvc  [label="requires(analytics)"];
  SearchBooks -> AnalyticsSvc  [label="requires(analytics)"];
  Audiobooks  -> AnalyticsSvc  [label="requires(analytics)"];
  DigitalMag  -> AnalyticsSvc  [label="requires(analytics)"];
  Membership  -> AnalyticsSvc  [label="requires(analytics)"];
  ContactUs   -> AnalyticsSvc  [label="requires(analytics)"];

  SearchBooks -> ExtMediaSvc   [label="requires(external_media)"];
  Audiobooks  -> ExtMediaSvc   [label="requires(external_media)"];
  DigitalMag  -> ExtMediaSvc   [label="requires(external_media)"];

  ContactUs   -> SupportSvc    [label="requires(support_chat)"];
  Membership  -> PaymentsSvc   [label="requires(payments)"];

  Home        -> PersonalSvc   [label="requires(personalization)"];
  Discover    -> PersonalSvc   [label="requires(personalization)"];

  Login       -> SecuritySvc   [label="requires(security)"];
  ContactUs   -> SecuritySvc   [label="requires(security)"];

  // =======================
  // Unlock semantics after accepts
  // =======================
  AcceptAll    -> SecuritySvc;
  AcceptAll    -> AnalyticsSvc;
  AcceptAll    -> ExtMediaSvc;
  AcceptAll    -> SupportSvc;
  AcceptAll    -> PaymentsSvc;
  AcceptAll    -> PersonalSvc;
  AcceptAll    -> ConsentSaved;

  Save         -> SecuritySvc   [label="selected? unlock"];
  Save         -> AnalyticsSvc  [label="selected? unlock"];
  Save         -> ExtMediaSvc   [label="selected? unlock"];
  Save         -> SupportSvc    [label="selected? unlock"];
  Save         -> PaymentsSvc   [label="selected? unlock"];
  Save         -> PersonalSvc   [label="selected? unlock"];
  Save         -> ConsentSaved;

  AccSecurity  -> SecuritySvc;
  AccAnalytics -> AnalyticsSvc;
  AccExtMedia  -> ExtMediaSvc;
  AccSupport   -> SupportSvc;
  AccPayments  -> PaymentsSvc;
  AccPersonal  -> PersonalSvc;

  // =======================
  // Services → Outcomes
  // =======================
  Essentials   -> Out_BasicAccess;

  {SecuritySvc, Login, ContactUs} -> Out_SecuredLogin;
  {AnalyticsSvc}                  -> OutcomeTelemetry;
  {ExtMediaSvc}                   -> Out_AllMedia;
  {PaymentsSvc, Membership}       -> Out_Payments;
  {PersonalSvc, Discover, Home}   -> Out_Personalized;

  {ExtMediaSvc, SupportSvc, PaymentsSvc, PersonalSvc} -> Out_AllContent;
}
DOT

